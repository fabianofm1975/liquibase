name: Run Local Migrations
on: 
  workflow_call:
    inputs:
      ENVIRONMENT:
        description: Environment from which the variables will be set
        required: true
        type: string

jobs:
  local-migrations:
    runs-on: ubuntu-latest
    environment: ${{ inputs.ENVIRONMENT }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Liquibase Update Action
        uses: liquibase-github-actions/update@v4.21.1
        env: 
          pg_password: ${{ secrets.POSTGRES_PASSWORD }}
        with:
          classpath: "${{ vars.POSTGRES_DATABASE }}/migrations/changes/"
          changelogFile: "postgres.changelog.sql"  
          rollbackOnError: true
          showSummary: "VERBOSE"
          username: ${{ vars.POSTGRES_USER }} 
          password: $pg_password
          url: jdbc:postgresql://${{ vars.POSTGRES_HOST }}:${{ vars.POSTGRES_PORT }}/${{ vars.POSTGRES_DATABASE }}
          
       
