name: Run Local Migrations
on: 
  workflow_call:
    inputs:
      BASE_DIR:
        description: Folder where to find the changelog file
        required: true
        type: string

jobs:
  local-migrations:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres
        env:
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: postgres
          POSTGRES_HOST: localhost
          POSTGRES_PORT: 5432
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports: 
          - 5432:5432
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Liquibase Update Action
        uses: liquibase-github-actions/update@v4.21.1
        with:            
            changelogFile: "${{ inputs.BASE_DIR }}/migrations/changelog.xml"  
            showSummary: "VERBOSE"
            url: "jdbc:postgresql://127.0.0.1:5432/postgres?user=postgres&password=postgres"
          
       
